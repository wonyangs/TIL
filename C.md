# 포인터와 배열

## 번지 연산

### 기초적인 번지 연산

- p가 배열의 어떤 요소에 대한 포인터라면 p++는 p가 다음 요소를 가리키게 한다.
- p += i는 현재의 요소로부터 i번째 요소를 가리키게 한다.

### 포인터의 성질

- 포인터는 다른 변수와 마찬가지로 초깃값을 설정할 수 있다.
- 포인터와 정수형은 바꾸어 사용할 수 없게 되어 있지만 포인터에서 0은 사용할 수 있다.
- 포인터의 값을 0으로 할 수도 있고 포인터와 0을 비교할 수도 있다.
- 0 대신 NULL을 사용할 수도 있으며 NULL은 <stdio.h>에 정의되어 있다.
- 포인터의 값을 비교할 수 있다.
    - p와 q가 같은 배열 내의 원소를 가리키는 포인터라면 비교연산자를 통해 비교를 할 수 있다.
    - 포인터를 0과 비교하는 것은 항상 가능하다.
    - 같은 배열의 원소를 가리키지 않는 두 포인터에 대한 비교나 연산의 결과는 아무 의미가 없다.
        - 예외적으로 배열의 긑과 바로 다음의 원소는 비교 가능하다.
- 포인터에 어떤 정수를 더하거나 뺄 수 있다.
    - p + n은 p가 가리키는 대상체의 n번째 다음 요소를 말한다.
    - p가 가리키는 대상체의 종류에 관계없이 n번째 다음이므로 실제 몇 바이트 뒤에 있는지를 컴파일러가 계산하게 된다.
        - 만약 p가 4바이트 정수라면 n번째 정수는 4n 바이트 뒤에 있게 된다.
    - p와 q가 같은 배열의 원소를 가리키고 있고 p < q라면 q-p+1은 p와 q 사이 원소의 개수가 된다.
- 포인터에 포인터를 더하거나 뺄 수 없고, 포인터에 실수를 더하거나 빼서도 안되며 곱셈이나 나눗셈을 해서도 안 된다.
- 포인터에 비트 연산을 해서도 안 된다.
- cast 연산자 없이 어떤 형의 포인터를 다른 형의 포인터로 사용하면 안 된다. (void는 예외)

### ptrdiff_t와 size_t

- <stdio.h>에는 ptrdiff_t라는 두 포인터의 위치 차이를 나타내는 형(type)을 정의하고 있음.
    - ptrdiff_t는 음의 값을 가질 수 있다.
- size_t는 sizeof 연산자에 의해 리턴되는 부호 없는 정수형 변수이다.

# 유니온

## 유니온이란?

- 유니온(union)은 사용할 때마다 다른 자료형과 다른 크기를 가질 수 있는 변수이다.
- 유니온이 사용되기 전 컴파일러가 크기와 정렬제한이 맞는지를 조사한다.
- 유니온은 프로그램이 기계에 종속되지 않으면서도 한 기억장소 내에서 서로 다른 데이터를 처리할 수 있도록 한다.

## 목적

- 컴파일러의 심벌 테이블에서 상수가 int나 float나 문자의 포인터라고 가정하자.
- 각 상수의 값은 그에 맞는 자료형의 변수에 기억되어야 한다.
- 그 값이 똑같은 양의 기억장소를 차지하고 그 자료형에 관계없이 같은 장소에 기억될 수 있다면 테이블 관리에 편리하다.
- 이처럼 변수가 어떤 임의의 자료형도 가질 수 있도록 하는 것이 유니온의 목적이다.

## 문법

```c
union u_tag {
	int ival;
	float fval;
	char *sval;
} u;
```

- 변수 `u`는 컴파일되는 기계에 관계없이 세 가지 자료형 가운데 가장 큰 것을 가질 수 있을 만큼 충분히 크다.
    
    → 이 프로그램은 하드웨어의 특성과 무관하게 된다.
    
- 이 세 가지 자료형 가운데 어느 것이라도 `u`에 할당되어 수식에서 사용될 수 있지만, 유니온에 기억할 때의 형과 사용되는 수식내에서의 형은 같아야 한다.
- 현재 유니온에 어떤 자료형이 기억되어 있는지를 알아내는 것은 프로그래머가 해야 한다.
- 유니온의 멤버를 표현하는 방법
    - `유니온 이름.멤버`
    - `유니온의 포인터 → 멤버`

## 예시

```c
if (utype == INT)
	printf("%d\n", u.ival);
else if (uytpe == FLOAT)
	printf("%f\n", u.fval);
else if (uytpe == STRING)
	printf("%s\n", u.sval);
else
	printf("bad type %d in utype\n", utype);
```

- 변수 `utype`이 현재 `u`의 자료형을 기억하고 있다면 위와 같이 활용할 수 있다.

## 정리

- 유니온은 모든 멤버의 기억장소 시작 위치가 같다.
- 유니온은 가장 큰 멤버도 표현할 수 있는 크기를 가진다.
- 유니온 내의 모든 자료형에 적절하게 정렬되는 구조체이다.
- 구조체와 마찬가지의 똑같은 연산이 유니온에서도 허용된다.
    - 정렬하거나 전체를 하나로 복사
    - 주소를 얻거나 멤버를 액세스 하는것
- 유니온은 멤버 중 가장 처음에 나오는 멤버의 자료형으로 초기화된다.
