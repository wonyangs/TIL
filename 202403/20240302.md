# 오브젝트 책 읽기 스터디
# 2장 - 객체지향 프로그래밍 (cont.)

## 4. 상속과 다형성

### 차이에 의한 프로그래밍

- 상속
  - 기존 클래스와 매우 흡사한 클래스를 추가하고 싶을 때 기존 코드를 재사용하기 위해 사용
  - 코드를 재사용하기 위해 가장 널리 사용되는 방법
  - 클래스 사이의 관계를 설정하여 기존 클래스가 가지고 있는 모든 속성과 행동을 물려 받는다.

- **차이에 의한 프로그래밍(programming by difference)**
  - 부모 클래스와 다른 부분만을 추가하여 새로운 클래스를 쉽고 빠르게 만드는 방법
  - 클래스 관계는 어떤 클래스를 기준으로 하느냐에 따라 상대적이다.

### 상속과 인터페이스

- 상속이 가치 있는 이유는 부모 클래스가 제공하는 모든 인터페이스를 자식 클래스가 물려받을 수 있기 때문.
  - 대부분의 사람들은 상속의 목적이 메서드나 인스턴스 변수를 재사용하는 것이라고 생각한다.

- 인터페이스는 객체가 이해할 수 있는 메시지의 목록을 정의한다.
  - 상속을 통해 자식 클래스는 자신의 인터페이스에 부모 클래스의 인터페이스를 포함한다.
  - 결과적으로 부모 클래스가 받을 수 있는 모든 메시지를 받을 수 있기 때문에, 자식 클래스를 부모 클래스와 동일한 타입으로 간주할 수도 있다.

- 메시지를 보내는 송신자 객체의 입장에서는 자신과 협력하는 객체가 어떤 클래스의 인스턴스인지는 중요하지 않다.
  - 오직 자신이 보내는 메시지를 수신할 수 있다는 사실이 중요하다.

- 자식 클래스는 상속을 통해 부모 클래스의 인터페이스를 물려받고, 부모 클래스 대신 사용될 수 있다
  - 자식 클래스가 부모 클래스를 대신하는 것을 **업캐스팅(upcasting)** 이라고 부른다.

### 다형성

- 메시지와 메서드는 다른 개념이다.
  - 메시지: 요청
  - 메서드: 요청을 처리하는 방법

- 객체가 메시지를 전송한 뒤, 실행 시점에 실제로 실행되는 메서드는 협력하는 객체의 실제 클래스가 무엇인지에 따라 달라진다.
  - 동일한 메시지를 전송하지만 실제로 어떤 메서드가 실행될 것인지는 수신하는 객체의 클래스에 따라 달라진다.
  - 이를 **다형성** 이라고 한다.

- 다형성은 객체지향 프로그램의 컴파일 시간 의존성과 실행 시간 의존성이 다를 수 있다는 사실을 기반으로 한다.
  - 객체지향의 특성을 이용해 서로 다른 메서드를 실행할 수 있게 한다.

- 다형성은 동일한 메시지를 수신했을 때 객체의 타입에 따라 다르게 응답할 수 있는 능력.
  - 따라서 다형적인 협력에 참여하는 객체들은 모두 같은 메시지를 이해할 수 있어야 한다.
  - 즉, 인터페이스가 동일해야 한다는 것
  - 인터페이스를 통일하기 위해 사용한 구현 방법이 상속이다.

- **지연 바인딩(lazy binding)**, **동적 바인딩(dynamic binding)**
  - 메시지와 메서드를 실행 시점에 바인딩하는 것
  - 하나의 메시지를 서로 다른 메서드에 연결할 수 있는 이유

- **초기 바인딩(early binding)**, **정적 바인딩(static binding)**
  - 전통적인 함수 호출처럼 컴파일 시점에 실행될 함수나 프로시저를 결정하는 것

- 상속은 다형성을 구현할 수 있는 유일한 방법이 아니다.
  - 다형성은 추상적인 개념
  - 구현할 수 있는 방법이 꽤 다양하다.

### 구현 상속과 인터페이스 상속

- **구현 상속(implementation inheritance)**
  - **서브클래싱(subclassing)** 이라고도 부름
  - 순수하게 코드를 재사용하기 위한 목적으로 상속을 사용하는 것

- **인터페이스 상속(interface inheritance)**
  - **서브타이핑(subtyping)**이라고도 부름
  - 다형적인 협력을 위해 부모 클래스와 자식 클래스가 인터페이스를 공유할 수 있도록 상속을 사용하는 것

- 상속은 구현 상속이 아닌 인터페이스 상속을 사용해야 한다.
  - 코드 재사용이 상속의 주된 목적이라는 것은 오해다.
  - 인터페이스를 재사용할 목적으로 상속을 사용하면 변경에 취약한 코드가 발생할 확률이 높다.

### 인터페이스와 다형성

- 구현을 공유할 필요가 없고 인터페이스만 공유하고 싶을 때 **인터페이스** 라는 프로그래밍 요소를 사용
  - C++의 경우 추상 기반 클래스(Abstract Base Class, ABC)를 사용

## 5. 추상화와 유연성

### 추상화의 힘

- 추상 클래스와 인터페이스는 같은 계층에 속하는 클래스들이 공통으로 가질 수 있는 인터페이스를 정의한다.
  - 구현의 일부 혹은 전체를 자식 클래스가 결정할 수 있도록 결정권을 위임한다.

- 추상화 계층만 따로 놓고 보면 요구사항의 정책을 높은 수준에서 서술할 수 있다.
  - 추상적인 개념들을 사용해 문장을 작성할 수 있다.
  - 세부적인 내용을 무시한 채 상위 정책을 쉽고 간단하게 표현할 수 있다.
  - 필요에 따라 표현의 수준을 조정할 수 있게 해준다.

- 추상화를 이용하면 설계가 좀 더 유연해진다.
  - 기존 구조를 수정하지 않고도 새로운 기능을 쉽게 추가할 수 있다.

- 새로운 자식 클래스들은 추상화를 이용해 정의한 상위 협력 흐름을 그대로 따르게 된다.
  - **디자인 패턴(design pattern)**, **프레임워크(framework)** 모두 추상화를 이용해 상위 정책을 정의한다.

### 유연한 설계

- 기존 설계에서 예외 사항이 생겼을 때 조건문을 사용하는 것은 대부분 좋지 않은 선택이다.
  - 예외 케이스를 최소화하고 일관성을 유지할 수 있는 방법을 선택하기
  - 기존 가지고 있던 책임을 계속 유지할 수 있도록 해야한다.

- 유연성이 필요한 곳에 추상화를 사용하자.

### 추상 클래스와 인터페이스 트레이드오프

- 이상적으로는 인터페이스를 사용하도록 변경한 설계가 더 좋다.
- 현실적으로는 하나의 기능을 더하기 위해 인터페이스를 추가하는 것이 과하다는 생각이 들 수도 있다.

- 구현과 관련된 모든 것들은 트레이드오프의 대상이 될 수 있다.
  - 작성하는 모든 코드에는 합당한 이유가 있어야 한다.
  - 사소한 결정이더라도 트레이드오프를 통해 얻어진 결론과 그렇지 않은 결론 사이의 차이는 크다.

### 코드 재사용

- 코드 재사용을 위해서는 상속보다는 **합성(composition)**이 더 좋은 방법이다.
  - 합성은 다른 객체의 인스턴스를 자신의 인스턴스 변수로 포함해서 재사용하는 방법
  - 상속과 합성은 기능적인 관점에서 완벽히 동일하다.

### 상속

- 상속은 객체지향에서 코드를 재사용하기 위해 널리 사용되는 기법
  - 하지만 상속은 캡슐화를 위반한다.
  - 상속은 설계를 유연하지 못하게 한다.

- 캡슐화 위반
  - 부모 클래스의 구현이 자식 클래스에게 노출됨
  - 자식 클래스가 부모 클래스에 강하게 결합되도록 만들음
  - 부모 클래스가 변경될 때 자식 클래스도 함께 변경될 확률을 높임

- 설계가 유연하지 못함
  - 상속은 부모 클래스와 자식 클래스 사이의 관계를 컴파일 시점에 결정함
  - 실행 시점에 객체의 종류를 변경하지 못한다.

- 상속보다 인스턴스 변수로 관계를 연결한 설계가 더 유연하다.

### 합성

- 합성: 인터페이스에 정의된 메시지를 통해서만 코드를 재사용하는 방법
  - 상속은 부모 클래스의 코드와 자식 클래스의 코드가 컴파일 시점에 하나로 강하게 결합된다.
  - 합성은 인터페이스를 통해 약하게 결합된다. -> 내부 구현을 알지 못한다.

- 합성은 상속이 가지는 두 가지 문제점을 모두 해결한다.
  - 인터페이스에 정의된 메시지를 통해서만 재사용이 가능 -> 캡슐화
  - 의존하는 인스턴스를 교체하는 것이 비교적 쉬움 -> 설계가 유연해짐

- 코드 재사용을 위해서는 상속보다는 합성을 선호하자
  - 상속은 클래스를 통해 강하게 결합된다.
  - 합성은 메시지를 통해 느슨하게 결합된다.

- 상속을 절대 사용하지 말자는 것은 아니다.
  - 코드 재사용 관점에서는 합성이 훨씬 우월하다.
  - 다형성을 위해 인터페이스를 재사용하는 경우 상속과 합성을 함께 조합해야 한다.

- 프로그래밍 관점에 너무 치우쳐 객체지향을 바라보면 본질을 놓칠 수 있다.
  - 클래스, 상속 같은 프로그래밍 요소도 중요하다.
  - 하지만 객체들 사이의 상호작용과 협력에 중점을 두어야 한다.
